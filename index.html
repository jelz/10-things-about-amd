<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>10 things about AMD</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/beige.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">
			<div class="slides">
				<section>
					<h1>10 things about AMD</h1>
					<h3>(that you should know)</h3>
					<p><small>Jakub Elżbieciak</small></p>
				</section>

				<section>
					<section>
						<h2>Short introduction to AMD</h2>
                        <ul>
                            <li>Asynchronous Module Definition</li>
                            <li>Model API for defining JS modules and its dependencies</li>
                            <li>Don't confuse with require.js</li>
                        </ul>
					</section>
					<section>
						<h2>Normal way of doing things</h2>
                        <pre><code data-trim>

&lt;script src=&quot;js/jquery.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/jquery.payment.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/jquery.ui.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/underscore.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/backbone.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/main-view.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/order-view.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/confirm-view.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/router.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/custom-logic.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app/user-collection.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/startup.js&quot;&gt;&lt;/script&gt;

                        </code></pre>
                        <p>Looks pretty organized, huh? :)</p>
					</section>
					<section>
						<h2>Problems</h2>
                        <ul>
                            <li>Scripts are sequentially loaded one-by-one</li>
                            <li>Order has to be maintained manually</li>
                            <li>Global object gets dirty</li>
                            <li>Things can be easily overridden</li>
                        </ul>
					</section>
					<section>
                        <h2>AMD-style module</h2>
                        <pre><code data-trim>

define([
    // define module's dependencies:
    'jquery', 'underscore', 'router', 'some/custom/module'
], function (
    // give them local names:
    $, _, Router, CustomModule
) {
    // ... do someting interesting here ...

    // export some useful things outside:
    return {
        fn1: function() { y(); },
        start: function () { x(); }
    };
});

                        </code></pre>
					</section>
                    <section>
                        <h2>Using it</h2>
                        <p>Assume that previous example was saved as <code>app.js</code></p>
                        <pre><code data-trim>

require(['jquery', 'app'], function ($, app) {
    $(function () {
        app.start();
    });
});

                        </code></pre>
                        <ul>
                            <li>Function passed as second argument will be called with the loaded jQuery function and our custom app object</li>
                            <li>Before loading app, all its dependencies will be loaded too</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Gluing with the markup</h2>
                        <p>Assume that previous example was saved as <code>main.js</code></p>
                        <pre><code data-trim>

&lt;script
    src=&quot;bower_components/requirejs/require.js&quot;
    data-main=&quot;app/main.js&quot;
&gt;&lt;/script&gt;

                        </code></pre>
                        <ul>
                            <li>It will load the whole application (eventually)</li>
                            <li>require.js is a <strong>loader</strong> (that implements AMD API)</li>
                            <li>As you can see, I use <em>bower</em> for package management</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Advantages</h2>
                        <ul>
                            <li>Modules have its privacy, dependencies are easy to fetch</li>
                            <li>There is no unintended module interference</li>
                            <li>Files are loaded asynchronously, but the order needed to fulfill dependencies is automatically handled</li>
                            <li>One simple build step leads into a compressed bundle (that can be grabbed with one HTTP request)</li>
                            <li>It works nice with modern tools (Grunt.js, bower)</li>
                        </ul>
                    </section>
				</section>
                
                <section>
                    <h2>Pay attention...</h2>
                    <p>...to ideas and possibilities</p>
                    <p>Code is only an illustration</p>
                    <p>10 complete examples to take a look at <a href="https://github.com/jelz/10-things-about-amd" target="_blank">on GitHub</a></p>
                </section>

				<section>
                    <section>
                        <h3>1st thing:</h3>
                        <h2>Simplified CommonJS Wrapper</h2>
                    </section>
                    <section>
                        <h2>Module definition...</h2>
                        <p>...that depends on one module</p>
                        <pre><code data-trim>

define(['jquery'], function ($) {
    // use $ here...
});

                        </code></pre>
                        <p>We also need <em>underscore</em> and <em>moment</em>!</p>
                        <pre><code data-trim>

define([
    'jquery', 'underscore', 'moment'
], function (
    $, _, moment
) {
    // use $, _, moment here...
});

                        </code></pre>
                    </section>
                    <section>
                        <h2>Real-life code</h2>
                        <pre><code data-trim>

define([
    'backbone', 'app', 'moment',
    'view/NavView', 'view/SwitchView',
    'view/DayView', 'view/WeekView', 'view/MonthView'
], function (
    Backbone, app, moment,
    NavView, SwitchView,
    DayView, WeekView, MonthView
) {
    // ...
});

                        </code></pre>
                        <ul>
                            <li>And it's still quite simple calendar application</li>
                            <li>When manipulating the list, it's not so hard to split up dependency from its right name</li>
                        </ul>
                    </section>
                    <section>
                        <h2>CommonJS Wrapper</h2>
                        <pre><code data-trim>

define(function (require) {
    var _ = require('underscore'),
        $ = require('jquery'),
        moment = require('moment');
        
    var updateClock = _.throttle(function () {
        var t = moment().format('H:mm:ss');
        $('#clock2').text(t);
    }, 1000);
        
    return {
        start: function () {
            updateClock();
            setInterval(updateClock, 990);
        }
    };
});

                        </code></pre>
                        <p>Pair variable with <code>require()</code> call &ndash; code gets much cleaner</p>
                    </section>
				</section>
                
                <section>
                    <section>
                        <h3>2nd thing:</h3>
                        <h2>Cajon</h2>
                    </section>
                    <section>
                        <h2>Module loader</h2>
                        <p>Remember module loader on the bottom of your HTML?</p>
                        <pre><code data-trim>

&lt;script
    src=&quot;bower_components/requirejs/require.js&quot;
    data-main=&quot;app/main.js&quot;
&gt;&lt;/script&gt;

                        </code></pre>
                        <p>RequireJS is only an inplementation and can be replaced by any other inplementation. Let's use Cajon</p>
                        <pre><code data-trim>

&lt;script
    src=&quot;node_modules/cajon/cajon.js&quot;
    data-main=&quot;app/main.js&quot;
&gt;&lt;/script&gt;

                        </code></pre>
                        <p>(as you can see, Cajon is installed using <em>npm</em>)</p>
                    </section>
                    <section>
                        <h2>Result</h2>
                        <p>What else to say &ndash; Cajon eliminates need of <code>define()</code> calls totally</p>
                        <pre><code data-trim>

var _ = require('underscore'),
    $ = require('jquery'),
    moment = require('moment');

var updateClock = _.throttle(function () {
    var t = moment().format('H:mm:ss');
    $('#clock').text(t);
}, 1000);

module.exports = {
    start: function () {
        updateClock();
        setInterval(updateClock, 990);
    }
};

                        </code></pre>
                        <p>This code can be loaded and executed without any troubles</p>
                    </section>
                    <section>
                        <h2>CommonJS-style</h2>
                        <ul>
                            <li>As a result, we get CommonJS-style modules</li>
                            <li><code>require()</code> calls load dependencies</li>
                            <li>assigning to <code>module.exports</code> allows to expose module's API</li>
                            <li>Don't think node.js modules will work out of the box</li>
                        </ul>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>3rd thing:</h3>
                        <h2>Circular dependencies</h2>
                    </section>
                    <section>
                        <h2>Alice has a cat</h2>
                        <pre><code data-trim>

// alice.js file
define(['cat'], function (cat) {
    return {
        name: 'Alice',
        haveWhat: function () {
            console.log('I\'m ' + this.name);
            console.log('I have ' + cat.name);
        }
    }
});

                        </code></pre>
                        <p>And vice versa</p>
                        <pre><code data-trim>

// cat.js file
define(['alice'], function (alice) {
    return {
        name: 'Cat George',
        haveWhat: function () {
            console.log('I\'m ' + this.name);
            console.log('I have ' + alice.name);
        }
    };
});

                        </code></pre>
                    </section>
                    <section>
                        <h2>Won't work</h2>
                        <ul>
                            <li>In circular dependency, one side gets undefined (to break the infinite loop)</li>
                            <li>To detect circular dependency, we can use <em>madge</em></li>
                            <li><code>madge --format amd --image dep-graph.png .</code></li>
                        </ul>
                        <img src="images/1.png" alt="">
                    </section>
                    <section>
                        <h2>More on madge</h2>
                        <ul>
                            <li>Blue &ndash; has dependencies</li>
                            <li>Green &ndash; has no dependencies</li>
                            <li>Red &ndash; has circular dependency</li>
                        </ul>
                        <img src="images/2.png" alt="">
                        <p>(graph healthier than previous one)</p>
                    </section>
                    <section>
                        <h2>Wrapper to rescue (again)</h2>
                        <pre><code data-trim>

define(function (require, exports, module) {
    var alice = require('alice');
    
    exports.name = 'Cat George';
    exports.haveWhat = function () {
        console.log('I\'m ' + this.name);
        console.log('I have ' + alice.name);
    };
    exports.sayWhatAliceSays = function () {
        console.log('She says:');
        alice.haveWhat();
    };
});

                        </code></pre>
                        <ul>
                            <li>When <code>exports</code> is used on both sides, then modules get valid references, that will be loaded, when module function returns</li>
                            <li>So cat module can use alice object in functions that it exports</li>
                            <li>It's still a circular dependency</li>
                        </ul>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>4th thing:</h3>
                        <h2>Almond</h2>
                    </section>
                    <section>
                        <h2>When in production</h2>
                        <ul>
                            <li>Requesting 50 modules, ~2kB each isn't a good idea</li>
                            <li>Requesting one, 5MB übermodule isn't a good idea too</li>
                            <li>What you need is a wise build step</li>
                            <li><code>r.js -o app/build.js</code></li>
                        </ul>
                    </section>
                    <section>
                        <h2>Building with RequireJS</h2>
                        <pre><code data-trim>

({
    baseUrl: '.',
    mainConfigFile: 'main.js',
    name: '../bower_components/requirejs/require',
    include: 'main',
    wrap: true,
    out: '../built/main.built.require.js'
})

                        </code></pre>
                        <ul>
                            <li>You'll end up with one file containing the whole application</li>
                            <li>It also contains XHR-related code (but you don't do AJAX, as build shrunk everything into one file)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Building with Almond</h2>
                        <pre><code data-trim>

({
    baseUrl: '.',
    mainConfigFile: 'main.js',
    name: '../bower_components/almond/almond',
    include: 'main',
    wrap: true,
    out: '../built/main.built.almond.js'
})

                        </code></pre>
                        <ul>
                            <li>Almond provides minimal AMD API</li>
                            <li>In my cases &ndash; ~16kB smaller output files</li>
                            <li>It buys you a Ferrari yearly (if you're big enough ;))</li>
                        </ul>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>5th thing:</h3>
                        <h2>text! plugin</h2>
                    </section>
                    <section>
                        <h2>On loader plugins</h2>
                        <ul>
                            <li>There's a standard of loader plugins</li>
                            <li>Loader chooses, if it should include plugin support</li>
                            <li>Both RequireJS and Almond include plugin support</li>
                            <li>Dependency that uses plugin for loading has special format: <code>plugin!dependency</code></li>
                        </ul>
                    </section>
                    <section>
                        <h2>text! plugin</h2>
                        <ul>
                            <li><em>text!</em> plugin allows to grab any text file from any accessible location.</li>
                            <li>Its content is passed into module function as normal string.</li>
                            <li>Popular plugin's application is to load templates</li>
                            <li>Having all your templates on the bottom of HTML, as <code>&lt;script&gt;</code> tags is messy and hard to maintain (especially when you do hundreds of atomic views)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Simple template cache</h2>
                        <pre><code data-trim>

var templates = [
    require('text!tpl/layout.html'),
    require('text!tpl/content.html'),
    require('text!tpl/menu.html')
];

_.each(templates, function (markup) {
    $(markup).appendTo($('body'));
});

                        </code></pre>
                        <p>Now, when editing, you know where to search each template</p>
                        <p>But don't forget about optimization!</p>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>6th thing:</h3>
                        <h2>i18n! plugin</h2>
                    </section>
                    <section>
                        <h2>JS internationalization done right</h2>
                        <p>Define root (default) translations</p>
                        <pre><code data-trim>

// file "nls/labels.js"
define({
    root: {
        change_lang: 'Change language',
        show_message: 'Show message'
    },
    pl: true
});

                        </code></pre>
                        <p><code>pl</code> key indicates that there is also translation for another language</p>
                        <pre><code data-trim>

// in file "nls/pl/labels.js"
define({
    change_lang: 'Zmień język',
    show_message: 'Pokaż wiadomość'
});

                        </code></pre>
                    </section>
                    <section>
                        <h2>Using it</h2>
                        <ul>
                            <li>When you <code>require('i18n!nls/labels')</code>, correct translations will be loaded</li>
                            <li><em>Correct</em> means "an intelligent guess of user's language, based on environment, falling back to default"</li>
                            <li>You can also set <code>locale</code> key in config</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Toggle lang (with localStorage)</h2>
                        <p>Read from localStorage when building config:</p>
                        <pre><code data-trim>

require.config({
    config: {
        i18n: {
            locale: localStorage.getItem('locale') || 'en'
        }
    }
});

                        </code></pre>
                        <p>Read, swap, set, reload on chosen event:</p>
                        <pre><code data-trim>

$('#toggle').on('click', function () {
    var current = localStorage.getItem('locale') || 'en';
    var next = 'en' === current ? 'pl' : 'en';
    localStorage.setItem('locale', next);
    window.location.reload();
});

                        </code></pre>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>7th thing:</h3>
                        <h2>jQuery integration</h2>
                    </section>
                    <section>
                        <h2>Look after your jQuery</h2>
                        <p>You should:</p>
                        <ul>
                            <li>Use CDN version of jQuery</li>
                            <li>Have fallback version setted up</li>
                            <li>Use local version in development</li>
                            <li>Have custom plugins loaded after loading jQuery</li>
                            <li>Write your plugins as AMD modules</li>
                            <li>Never use old-style <code>jquery-require.js</code> files</li>
                        </ul>
                    </section>
                    <section>
                        <h2>SIAF jQuery path config</h2>
                        <pre><code data-trim>

require.config({
    paths: {
        jquery: (function () {
            var local = window.location.host.match(/localhost/);
            var paths = [
                'http://codeorigin.jquery.com/jquery-2.0.3.min',
                '../bower_components/jquery/jquery'];
            return local ? paths.reverse() : paths;
        }())
    }
});

                        </code></pre>
                        <p>It simply handles first three points</p>
                    </section>
                    <section>
                        <h2>Shim config</h2>
                        <ul>
                            <li>Some jQuery plugins don't have their AMD version</li>
                            <li>When requested, jQuery object can be still undefined, so plugin can't be correctly registered</li>
                            <li><em>Shim config</em> allows to define dependencies for vendors, without modifying its code</li>
                        </ul>
                        <pre><code data-trim>

require.config({
    paths: {
        jquery: '../bower_components/jquery/jquery'
        'jquery.payment': '../bower_components/jquery.payment/lib/jquery.payment'
    },
    shim: {
        'jquery.payment': ['jquery']
    }
});

                        </code></pre>
                    </section>
                    <section>
                        <h2>When comercial, use AMD</h2>
                        <p>When writing open-source plugins, keep jQuery styleguide.</p>
                        <p>When writing for you or client, use AMD.</p>
                        <pre><code data-trim>

define(function (require) {
    var $ = require('jquery');
    
    $.fn.fart = function () {
        alert('fart!');
    };
});

                        </code></pre>
                        <p>(very stupid jQuery plugin, AMD style)</p>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>8th thing:</h3>
                        <h2>Packages</h2>
                    </section>
                    <section>
                        <h2>Organize your code even better</h2>
                        <ul>
                            <li>Package is a bunch of modules, that serves for a common or similar purpose</li>
                            <li>First profit: you get simple prefix for all modules in directory, no matter where it's located</li>
                            <li>Second profit: you can select main file of package, that will be loaded, when package name is requested</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Defining packages</h2>
                        <p>When in base directory (it defines <em>util</em> and <em>widget</em> packages in corresponding subdirectories, with main files named <code>main.js</code>)</p>
                        <pre><code data-trim>

require.config({
    packages: ['util', 'widget']
});

                        </code></pre>
                        <p>Package config options used</p>
                        <pre><code data-trim>

require.config({
    packages: ['widget', {
        main: 'index',
        location: '../vendor/widget'
    }]
});

                        </code></pre>
                        <small>Calling <code>require('widget/input')</code> will load <code>../vendor/widget/input.js</code>, calling <code>require('widget')</code> will load <code>../vendor/widget/index.js</code>)</small>
                    </section>
                    <section>
                        <h2>Index modules</h2>
                        <ul>
                            <li>There is a popular pattern, derived from node.js community, to define main file of package as index module</li>
                            <li>Index module returns object with references to all package modules that should be available for developer</li>
                        </ul>
                        <pre><code data-trim>

define(function (require) {
    return {
        date: require('widget/date'),
        input: require('widget/input')
    };
});

                        </code></pre>
                        <p>(keep in mind that loading index loads all its modules)</p>
                    </section>
                </section>
                
                <section>
                    <section>
                        <h3>9th thing:</h3>
                        <h2>Bootstrap</h2>
                    </section>
                    <section>
                        <h2>Twitter Bootstrap, I mean</h2>
                        <ul>
                            <li>You installed less or sass version with bower</li>
                            <li>You handle compilation on your own</li>
                            <li>But when it comes to Bootstrap JS plugins, you use "customize" page (or just throw everything into your page)</li>
                            <li>But in your vendors you can find nicely splitted source files</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Handle it on your own</h2>
                        <p>Create package for Bootstrap</p>
                        <pre><code data-trim>

require.config({
    paths: {
        jquery: '../bower_components/jquery/jquery'
    },
    packages: [
        'bootstrap', {
            name: 'bootstrap',
            location: '../bower_components/bootstrap/js'
        }
    ],
    shim: {
        bootstrap: ['jquery']
    }
});

                        </code></pre>
                        <p>Now it's under your fingers</p>
                    </section>
                    <section>
                        <h2>Result</h2>
                        <pre><code data-trim>

define([
    'bootstrap/modal', 'bootstrap/tooltip', 'bootstrap/transition'
], function () {
    // play with bootstrap
});

                        </code></pre>
                        <ul>
                            <li>You see what you use</li>
                            <li>You don't type too much (you can even name package Bootstrap package "<code>b</code>")</li>
                            <li>When building, with every unused plugin, you loose next kilobytes of code</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <section>
                        <h3>10th thing:</h3>
                        <h2>Know alternative</h2>
                    </section>
                    <section>
                        <h2>browserify</h2>
                        <ul>
                            <li>There is a project called <em>browserify</em></li>
                            <li>Its parser tracks dependencies of CommonJS-style modules and packs them into one bundle in build process</li>
                            <li>It allows to use <em>npm</em> modules in the browser</li>
                            <li>It requires build step on every change (Grunt's watch task is probably a good idea)</li>
                        </ul>
                    </section>
                    <section>
                        <h2>Sample code</h2>
                        <pre><code data-trim>

var $ = require('jquery-browserify'),
    moment = require('moment');

var updateClock = function () {
    var t = moment().format('H:mm:ss');
    $('#clock').text(t);
};

updateClock();
setInterval(updateClock, 1000);

                        </code></pre>
                        <p>Bundle with: <code>browserify app/main.js -o bundle.js</code></p>
                    </section>
                </section>
                
				<section>
					<h1>Thank you!</h1>
					<h3>Any questions?</h3>
                    <p><a href="mailto:jelz@post.pl">jelz@post.pl</a></p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
